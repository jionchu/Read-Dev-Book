# 💡 동시성

## 1. 동시성에 대해
- 올바른 동시성 코드
  - 특정 입력에 대해 항상 같은 결과를 내지만, 실행 순서에는 약간의 가변성을 허용해야 한다.
  - 그러려면 코드의 서로 다른 부분들이 독립성이 있어야 한다.
- 동시성을 이해하는 가장 좋은 방법
  - 순차적인(비동시성) 코드와 동시성 코드 비교하기

### :train: 순차 코드
- 순차 코드의 장점
  - 정확한 실행 순서를 쉽게 알 수 있어 예측하지 못한 일이 벌어지지 않는다.
- 순차 코드의 문제점
  - 동시성 코드에 비해 성능이 저하될 수 있다.
  - 코드가 실행되는 하드웨어를 제대로 활용하지 못할 수 있다.

순차 코드의 각 서비스가 서로 의존하지 않는다면 동시에 호출해서 실행 시간을 줄일 수 있다.

### 🚗 동시성 코드
```kotlin
suspend fun getProfile(id: Int) {
    val basicUserInfo = asyncGetUserInfo(id)
    val contactInfo = asyncGetContactInfo(id)

    createProfile(basicUserInfo.await(), contactInfo.await())
}
```

- 동시성 코드의 getProfile 함수에는 ***suspend*** 수식어가 있으며 async 함수 둘은 비동기로 구현되었다고 가정한다. 두 함수는 서로 다른 스레드에서 동시에 실행된다.
- 이 때 각 서비스가 실행되는데 걸리는 시간은 가변적이므로 두 서비스의 응답을 사용하는 createProfile 함수를 호출할 때에는 ***await()*** 호출을 통해 두 서비스가 모두 완료될 때까지 함수의 실행을 일시 중단한다.
- 이렇게 해서 동시성 코드에서 부분이 완성되는 순서에 관계없이 결과가 결정적임을 보장한다.

## 2. 동시성은 병렬성이 아니다.
동시성과 병렬성을 흔히 혼동한다. 동시적 실행과 병렬적 실행의 타임라인이 같아 보이는 이유는 해당 타임라인이 하위 레벨에서 일어나고 있는 일을 보여줄 만큼 세분화되어 있지 않기 때문이다.

### :eyes: 동시성과 병렬성의 차이
- 동시성
  - 두 개 이상의 알고리즘의 실행 시간이 겹쳐질 때 발생한다.
  - 중첩이 발생하려면 두 개 이상의 실행 스레드가 필요하다.
  - 단일 코어는 두 스레드를 동시에 실행할 수 없기 때문에 스레드들이 단일 코어에서 실행되면 병렬이 아니라 동시에 실행된다.
  - 단일 코어가 서로 다른 스레드의 instruction을 교차 배치해서 스레드들의 실행을 효율적으로 겹쳐서 실행한다. 각 함수들은 스케줄이 겹치지만 정확히 같은 시점에 동시에 실행되고 있는 경우는 없다.
- 병렬성
  - 두 개의 알고리즘이 정확히 같은 시점에 실행될 때 발생한다.
  - 2개 이상의 코어와 2개 이상의 스레드가 있어야 각 코어가 동시에 스레드의 instruction을 실행할 수 있다.
  - 병렬은 동시성을 의미하지만 동시성은 병렬성 없이도 발생할 수 있다.

이 차이는 단순히 사소한 기술적인 세부사항이 아니기 때문에 차이를 이해해야 제대로 작동하는 코드를 작성할 수 있다.

> 병렬성의 필요조건인 두 개 이상의 코어는 꼭 로컬 컴퓨터로 국한되지 않는다. 애플리케이션이 네트워크의 여러 다른 컴퓨터에서 분산 작업을 실행하는 분산 컴퓨팅(distributed computing)도 병렬성의 한 형태다.
